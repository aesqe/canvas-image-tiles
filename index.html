<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <!--link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print"-->
    <link rel="stylesheet" type="text/css" href="stylesheets/app.css">

    <script type="text/javascript" src="lib/hammer.js"></script>
    <script type="text/javascript" src="javascripts/CanvasShredder.js"></script>

    <title>Split image to tiles with canvas</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Canvas image tiles</h1>
        <h2>Creates tiles from huge images with help of html5 canvas.</h2>

        <section id="downloads">
          <a href="https://github.com/elhigu/canvas-image-tiles/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/elhigu/canvas-image-tiles/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/elhigu/canvas-image-tiles" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h3>
          <a id="creating-tiles-from-huge-images-with-canvas" class="anchor" href="#creating-tiles-from-huge-images-with-canvas" aria-hidden="true">
            <span class="octicon octicon-link"></span>
          </a>
          Sampling tiles from huge images with canvas
        </h3>
        <h4>What it does?</h4>
        <p>
          <ol>
            <li>Reads huge e.g. 250Mpixel image from file</li>
            <li>Stores original data to <em>full size non visible canvas</em> or to <em>&lt;img&gt; tag that is
              not attached to DOM</em> and creates visible preview version of image to <em>preview canvas</em></li>
            <li>Uses CSS transformations to show preview how source image is translated.</li>
            <li>Apply <em>rotate</em>, <em>scale</em>, and <em>translate</em> to be able to read any part
              of original image to 256x256 sized tile.</li>
          </ol>
        </p>
        <p>
          Proof of concept implementation to demonstrate splitting custom map tiles in browser instead of backend.
          Issues/more info found in <a href="https://github.com/elhigu/canvas-image-tiles"><span class="icon"></span>https://github.com/elhigu/canvas-image-tiles</a>
        </p>
        <h4>Transforming image</h4>
        <p>
          Transforming huge image could be slow with canvas, because potentially browser has to transform whole image
          before starting to drawImage to destination canvas.

        <p><img src="https://raw.githubusercontent.com/elhigu/canvas-image-tiles/master/doc/direct_transform.jpg" /></p>

          So actually we are not doing any transformations to source image, but just do inverse transformations for
          destination canvas to get correct data from huge source image. I.e. we rotate, scale and move 256x256 square
          to top of source and then fill it with data from correct position.

          <p><img src="https://raw.githubusercontent.com/elhigu/canvas-image-tiles/master/doc/inverse_transform.jpg" /></p>
        </p>
        <h4>Storing full sized source image</h4>
        <p>
          Full sized source image can be stored in Image() object or in canvas object. For some browsers it makes
          no difference which one is used, but for other browsers, Image() object uses a lot less memory, but causes
          performance loss and jumpy memory consumption when drawing data to destination canvas.
        </p>
        <p>
          On some browsers Image() uses a lot less memory and works better in all cases. Currently by defaults slicer
          stores original data in off screen canvas, except for iOS where using Image() object seems to work
          better.
        </p>
        <p>
          Showing original image in <em>&lt;img&gt;</em> tag and scaling it with CSS is slow for big images.
          There for we are using down scaled <em>preview canvas</em> to adjust source image orientation in UI.
        </p> 
      </section>
      <section>
        <h3>Try it</h3>
        <p>
          Reads file in, creates / shows preview (max 2048x2048). Preview canvas is used to position image on top
          of area where one can select which part of image should be read to 256x256 tile.
        </p>
        <p>
          iOS does automatic downscaling when loading big images, so don't be amazed if image
          dimensions seem different than you would expect. Also on iOS really big images (like 200Mpix)
          just silently fail.
        </p>
        <p>
          Drag from <b>S (Scale)</b>, <b>M (Move)</b>, and <b>R (Rotate)</b> buttons to adjust preview image position.
          Or use pinch, rotate, tap, pan touch gestures on touch devices.
        </p>

        <span>Choose image:</span>
        <input type="file" id="file-input"><br/>
        <span>Fps:</span>
        <span id="fps"></span><br/>
        <span>Image size:</span>
        <span id="image-info"></span><br/>

        <span>Click area below to select tile position</span>
        <div id="preview-area">
          <div id="select-position"></div>
          <div class="buttons">
            <div class="ctrl-btn move">M</div>
            <div class="ctrl-btn rotate">R</div>
            <div class="ctrl-btn scale">S</div>
          </div>
          <canvas id="dst-canvas" width="256" height="256"></canvas>
        </div>
        <canvas id="tile-out" width="256" height="256"></canvas>
      </section>
    </div>
    <script type="text/javascript" src="javascripts/app.js"></script>
 
  </body>
</html>
